<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tech Pulse — AI • Tech • InfoSec</title>

<!-- Inter + Tailwind -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html,body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .reveal{opacity:0;transform:translateY(10px);transition:.4s ease}
  .reveal.show{opacity:1;transform:none}
</style>
</head>
<body class="bg-white text-slate-900">

<!-- Header -->
<header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-slate-200">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-slate-900 text-white font-bold">TP</span>
        <span class="font-semibold">Tech Pulse</span>
      </div>
      <div id="updated" class="text-xs text-slate-500"></div>
    </div>
  </div>
</header>

<!-- Hero -->
<section class="relative overflow-hidden">
  <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1535223289827-42f1e9919769?q=80&w=2100&auto=format&fit=crop')] bg-cover bg-center"></div>
  <div class="absolute inset-0 bg-gradient-to-br from-black/70 via-black/40 to-transparent"></div>
  <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-20 sm:py-28 text-white">
    <div class="max-w-2xl reveal">
      <p class="text-xs uppercase tracking-widest text-white/70">Curated daily</p>
      <h1 class="mt-2 text-4xl sm:text-6xl font-extrabold leading-tight">AI, Tech, and InfoSec — at a glance.</h1>
      <div class="mt-6 flex gap-2">
        <input id="q" class="w-full max-w-md rounded-xl bg-white/90 text-slate-900 placeholder-slate-500 px-4 py-2 text-sm"
               placeholder="Search titles…" />
        <select id="sort" class="rounded-xl bg-white/90 text-slate-900 px-3 py-2 text-sm">
          <option value="new">Newest</option>
          <option value="old">Oldest</option>
          <option value="az">A → Z</option>
        </select>
      </div>
    </div>
  </div>
  <svg class="absolute -bottom-6 left-1/2 -translate-x-1/2" width="1400" height="60" viewBox="0 0 1400 60" fill="none" aria-hidden="true">
    <path d="M0 60C350 60 350 0 700 0C1050 0 1050 60 1400 60H0Z" fill="#fff"/>
  </svg>
</section>

<!-- Columns -->
<main id="news" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
  <div id="grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- JS injects three columns -->
  </div>
</main>

<!-- Footer -->
<footer class="border-t border-slate-200">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10 text-sm text-slate-600 flex items-center justify-between">
    <p>© <span id="year"></span> Tech Pulse</p>
  </div>
</footer>

<script>
  const DEFAULT_ENDPOINT = './feed.json';
  const qEl = document.getElementById('q');
  const sortEl = document.getElementById('sort');
  const updatedEl = document.getElementById('updated');
  const grid = document.getElementById('grid');

  let allItems = [];

  // helpers
  const timeAgo = d => {
    const t = Math.floor((Date.now()-d.getTime())/1000);
    const u=[['y',31536000],['mo',2592000],['d',86400],['h',3600],['m',60],['s',1]];
    for(const [n,s] of u){const v=Math.floor(t/s);if(v>=1)return v+n;}
    return 'now';
  };
  const escapeHtml = s => String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  const domainOf = url => { try{ return new URL(url).hostname; } catch { return ''; } };
  const catFrom = url => { try{ const p=new URL(url).pathname.toLowerCase(); if(p.includes('/ai/')) return 'AI'; if(p.includes('/infosec/')) return 'INFOSEC'; } catch{} return 'TECH'; };

  // favicon/logo service (fallbacks)
  const faviconUrl = url => {
    const d = domainOf(url);
    if(!d) return 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
    // Clearbit often has logos; fallback to Google favicon
    return `https://logo.clearbit.com/${d}`;
  };

  // render columns
  function render(){
    const q = (qEl.value||'').toLowerCase();
    const mode = sortEl.value;
    let items = allItems.filter(it =>
      it.title.toLowerCase().includes(q)
      || (it.source||'').toLowerCase().includes(q)
      || (it.summary||'').toLowerCase().includes(q)
    );
    items.sort((a,b)=>{
      if(mode==='az') return a.title.localeCompare(b.title);
      if(mode==='old') return (a.published - b.published);
      return (b.published - a.published);
    });

    const bucket = { AI:[], TECH:[], INFOSEC:[] };
    items.forEach(it => bucket[it.category].push(it));

    grid.innerHTML = '';
    [['AI','bg-blue-600'], ['TECH','bg-emerald-600'], ['INFOSEC','bg-rose-600']].forEach(([label,color])=>{
      const col = document.createElement('section');
      col.className = 'reveal';

      const itemsHtml = bucket[label].map(it => `
        <article class="group overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm hover:shadow-md transition">
          <div class="h-1 ${color}"></div>
          <div class="p-4 flex gap-3">
            <img class="h-6 w-6 rounded-sm ring-1 ring-slate-200" src="${faviconUrl(it.link)}" onerror="this.style.visibility='hidden'"/>
            <div class="min-w-0">
              <h3 class="font-semibold leading-snug">
                <a class="hover:underline" href="${it.link}" target="_blank" rel="noopener">${escapeHtml(it.title)}</a>
              </h3>
              <div class="mt-1 text-xs text-slate-500 flex items-center gap-2">
                ${it.source ? `<span>${escapeHtml(it.source)}</span>·` : ''}
                ${it.published ? `<time>${timeAgo(it.published)}</time>` : ''}
              </div>
              ${it.summary ? `<p class="mt-2 text-sm text-slate-600 line-clamp-2">${escapeHtml(it.summary)}</p>` : ''}
            </div>
          </div>
        </article>
      `).join('');

      col.innerHTML = `
        <header class="mb-3 flex items-center gap-2">
          <span class="inline-block h-3 w-3 rounded-full ${color}"></span>
          <h2 class="font-bold tracking-tight">${label}</h2>
          <span class="text-xs text-slate-500">(${bucket[label].length})</span>
        </header>
        <div class="space-y-3">
          ${itemsHtml || `<div class="text-sm text-slate-500">No articles.</div>`}
        </div>
      `;
      grid.appendChild(col);
    });

    // reveal
    requestAnimationFrame(()=>document.querySelectorAll('.reveal').forEach(el=>el.classList.add('show')));
  }

  async function load(){
    const r = await fetch(DEFAULT_ENDPOINT, {headers:{'Accept':'application/json'}});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const data = await r.json();
    const root = Array.isArray(data?.items) ? data.items : (Array.isArray(data) ? data : [data]);
    const flat = deepFlatten(root);
    allItems = flat.map(x=>{
      const title = x.title || '(Untitled)';
      const link = x.link || x.guid || '#';
      const summary = x.summary || x.description || x.contentSnippet || '';
      const source = x.source || x.site || x.creator || x['dc:creator'] || '';
      const published = new Date(x.isoDate || x.pubDate || x.published || x.date || Date.now());
      return { title, link, summary, source, published, category: catFrom(link) };
    }).filter(i=>i.link && i.title);

    updatedEl.textContent = 'Updated ' + new Date().toLocaleString();
    render();
  }

  function deepFlatten(x,out=[]){
    if(Array.isArray(x)){ x.forEach(i=>deepFlatten(i,out)); return out; }
    if(x && typeof x==='object'){
      if('json' in x) return deepFlatten(x.json,out);
      if('data' in x && Array.isArray(x.data)) return deepFlatten(x.data,out);
      if(x.title || x.link || x.guid) out.push(x);
      for(const k in x){ if(typeof x[k]==='object') deepFlatten(x[k],out); }
    }
    return out;
  }

  // init
  document.getElementById('year').textContent = new Date().getFullYear?.() || new Date().getFullYear;
  qEl.addEventListener('input', render);
  sortEl.addEventListener('change', render);
  load().catch(e=>{
    grid.innerHTML = `<div class="md:col-span-3 text-sm text-rose-600">Load failed: ${e.message}</div>`;
  });
</script>
</body>
</html>
